{% if not request.headers.get("Hx-Request") %}
  {% extends "base.html" %}
{% endif %}

{% block body %}

<h6>Settings</h6>

<section class="grid split-grid">
  <article>
    <hgroup>
      <h6>{{ L["System settings"] }}</h6>
      <p>{{ L["System settings will be replicated to the cluster"] }}</p>
    </hgroup>
  </article>

  <div>
    <section id="system-settings"
      hx-trigger="reloadSettings"
      hx-target="this"
      hx-select="#system-settings"
      hx-swap="outerHTML"
      hx-get="/system/settings">
      <form
        _="on htmx:afterRequest[event.detail.successful==true] from me trigger reloadSettings on #system-settings"
        id="system-settings-form"
        hx-trigger="submit throttle:200ms"
        hx-patch="/system/settings">
        {% with
          schema=forms.system.settings,
          current_data=data.settings
        %}
          {% include "includes/form_builder.html" %}
        {% endwith %}
        <button data-loading-disable type="submit">{{ L["Save"] }}</button>
      </form>
    </section>

    <section>
      <form hx-trigger="submit throttle:200ms" hx-patch="/system/settings">
        <h6>Handler priorities</h6>
        <div class="overflow-auto">
        {% for handles, extractors in data.extractors.items() %}
          <table class="striped">
            <thead>
              <tr>
                <th colspan="3">ðŸ“¦ {{ handles.value|capitalize }}</th>
              </tr>
              <tr class="small">
                <th scope="col">Name</th>
                <th scope="col">Default priority</th>
                <th scope="col">Override priority</th>
              </tr>
            </thead>
            <tbody class="small">
            {% for extractor in extractors|sort(attribute=1) %}
              <tr>
                <th scope="row">{{ extractor[0]|replace("_", " ")|title }}</th>
                <td>
                  <input type="number" disabled value="{{ extractor[1] }}" />
                </td>
                <td>
                  <input
                    type="number"
                    min="-9999"
                    max="9999"
                    name="extractor_priority_overrides.{{ handles.value|replace(".", "") }}.{{ extractor[0]|replace(".", "") }}"
                    value="{{ data.settings.extractor_priority_overrides.get(handles.value, {}).get(extractor[0], '') }}" />
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        {% endfor %}
        </div>
        <button data-loading-disable type="submit">{{ L["Save"] }}</button>
      </form>
    </section>
  </div>

</section>


{% endblock body %}
