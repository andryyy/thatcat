<!doctype html>
<html lang="en" on>
  <head>
    <meta charset="utf-8">
    <meta name="htmx-config" content='{"htmx.config.allowScriptTags":"false"}'>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Carrr</title>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <link rel="manifest" href="/static/manifest.json" />
    <meta name="theme-color" content="var(--pico-primary)">
    <link href="/static/css/pico-custom.css" rel="stylesheet">
    <link href="/static/css/leaflet.css" rel="stylesheet">
    <script>
      const theme = localStorage.getItem('theme') || 'light';
      document.documentElement.dataset.theme = theme;
    </script>
    <script type="text/hyperscript" src="/_hs/common._hs" defer></script>
    <script type="text/hyperscript" src="/_hs/notifications._hs" defer></script>
    <script type="text/hyperscript" src="/_hs/ws._hs" defer></script>
    <script type="text/hyperscript" src="/_hs/leaflet._hs" defer></script>
    <script type="text/hyperscript" src="/_hs/vault._hs" defer></script>
    <script type="text/hyperscript" src="/_hs/svg_markers._hs" defer></script>
    <script src="/static/bundle.js"></script>
  </head>

  <body _="install bodydefault" hx-ext="loading-states">
    <header>
    {% block menu %}
      {% include "includes/menu.html" %}
    {% endblock %}
    </header>

    <main id="body-main" hx-history-elt>
    {% block body %}
    {% endblock %}
    </main>

    <footer>
    {% block footer %}
      <div id="notifications" _="install notifications"></div>
      <dialog id="img-zoom" _="on click
        if event.target is in me
        put '' into me
        remove @open from me
        remove .no-interaction from body
      end"></dialog>
      {% if session["login"] %}
      <div id="ws-main" _="install wsHandler"></div>
      {% endif %}
    {% endblock %}
    </footer>
  </body>
</html>

<template id="notification-template">
  <div class="notification ${colorClass}" _="
    init
      wait ${duration}ms transition my opacity to 0 over 200ms remove me
    end
    on dblclick
      transition my opacity to 0 over 100ms
      remove me
    end">
    <span class="title">${title}</span><br>
    @if level is in ['error', 'warning', 'validationError'] set bullet to '&#10071;' end
    @if message is a Array
      @repeat for m in message
      <span class="text">${bullet} ${m}</span><br>
      @end
    @else
      <span class="text">${bullet} ${message}</span><br>
    @end
  </div>
</template>

